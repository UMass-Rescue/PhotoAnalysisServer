

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Citadel Server Documentation &mdash; Citadel Server 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> Citadel Server
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Citadel Server Documentation</a></li>
<li><a class="reference internal" href="#core-modules">Core Modules</a><ul>
<li><a class="reference internal" href="#main">Main</a></li>
<li><a class="reference internal" href="#dependency-server-file">Dependency Server File</a></li>
<li><a class="reference internal" href="#database-connection-file">Database Connection File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-routers">HTTP Routers</a><ul>
<li><a class="reference internal" href="#model-prediction-router">Model Prediction Router</a></li>
<li><a class="reference internal" href="#dataset-and-training-router">Dataset and Training Router</a></li>
<li><a class="reference internal" href="#authentication-router">Authentication Router</a></li>
</ul>
</li>
<li><a class="reference internal" href="#docker-redis-worker">Docker Redis Worker</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Citadel Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Citadel Server Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="citadel-server-documentation">
<h1>Citadel Server Documentation<a class="headerlink" href="#citadel-server-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="core-modules">
<h1>Core Modules<a class="headerlink" href="#core-modules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="main">
<h2>Main<a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h2>
<p>The main file handles the startup/shutdown of the server and is the file directly associated with
FastAPI. CORS requests and router registration is handled via this file.</p>
<span class="target" id="module-main"></span><dl class="py function">
<dt id="main.credential_exception_handler">
<em class="property">async </em><code class="sig-prename descclassname">main.</code><code class="sig-name descname">credential_exception_handler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">request</span><span class="p">:</span> <span class="n">starlette.requests.Request</span></em>, <em class="sig-param"><span class="n">exc</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.CredentialException" title="dependency.CredentialException">dependency.CredentialException</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#main.credential_exception_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handler for credential exception. This type of exception is raised when a client attempts to access an endpoint
without sufficient permissions for endpoints that are protected by OAuth2. This exception is raised if the client
has no bearer token, if the bearer token is expired, or if their account does not have sufficient permissions/roles
to access a certain endpoint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> – HTTP Request object</p></li>
<li><p><strong>exc</strong> – Exception</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>401 HTTP Exception with authentication failure message</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="main.on_shutdown">
<code class="sig-prename descclassname">main.</code><code class="sig-name descname">on_shutdown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#main.on_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>On server shutdown, stop all background model pinging threads, as well as clear
the redis model prediction queue. This is necessary to prevent the workers from
spawning multiple instances on restart.</p>
</dd></dl>

<dl class="py function">
<dt id="main.root">
<em class="property">async </em><code class="sig-prename descclassname">main.</code><code class="sig-name descname">root</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#main.root" title="Permalink to this definition">¶</a></dt>
<dd><p>Root endpoint that validates the server is running. This requires no authentication to call, and will always
return the same result so long as the server is running.
:return: {‘status’: ‘success’} if server is running, else no HTTP response.</p>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The main.py file is only used for startup/shutdown and registering routers. No actual
computation or logic takes place in this file.</p>
</div>
</div>
<div class="section" id="dependency-server-file">
<h2>Dependency Server File<a class="headerlink" href="#dependency-server-file" title="Permalink to this headline">¶</a></h2>
<p>This file contains all of the shared objects used throughout the server. Ranging from Pydantic models to
constants, it is the single location for objects that are used between modules or passed around frequently.</p>
<span class="target" id="module-dependency"></span><dl class="py class">
<dt id="dependency.APIKeyData">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">APIKeyData</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">key</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">type</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">user</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">detail</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">enabled</span><span class="p">:</span> <span class="n">bool</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.APIKeyData" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that contains information on a registered API key. API keys may only be registered for one microservice
type and may be disabled at any time.</p>
</dd></dl>

<dl class="py exception">
<dt id="dependency.CredentialException">
<em class="property">exception </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">CredentialException</code><a class="headerlink" href="#dependency.CredentialException" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised in main.py when a user does not have access to an endpoint. HTTP 401</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.ExternalServices">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">ExternalServices</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.ExternalServices" title="Permalink to this definition">¶</a></dt>
<dd><p>Enum that contains valid external microservices. This enum is used with API keys to ensure that the service
using an API key is authorized only for specific endpoints.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.MicroserviceConnection">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">MicroserviceConnection</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">modelName</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">modelPort</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.MicroserviceConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that is passed/received via HTTP request when registering a new model or dataset to the server.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.Roles">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">Roles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.Roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Enum that contains valid role/permission levels. This is used to ensure that users can only access endpoints
related to the role that they have been assigned.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.Settings">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">Settings</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">_env_file</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>pathlib.Path<span class="p">, </span>str<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'&lt;object object&gt;'</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">available_models</span><span class="p">:</span> <span class="n">dict</span> <span class="o">=</span> <span class="default_value">{}</span></em>, <em class="sig-param"><span class="n">available_datasets</span><span class="p">:</span> <span class="n">dict</span> <span class="o">=</span> <span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.Settings" title="Permalink to this definition">¶</a></dt>
<dd><p>BaseSettings used to hold available models and datasets for training and prediction.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.Token">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">Token</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">access_token</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">token_type</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.Token" title="Permalink to this definition">¶</a></dt>
<dd><p>OAuth2 access token object that is sent via HTTP request.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.TokenData">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">TokenData</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.TokenData" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that stores additional data for an OAuth2 bearer token. The server only tracks username with the token
since username is a primary key to the user objects collection.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.TrainingRequestHttpBody">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">TrainingRequestHttpBody</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">dataset</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">model_structure</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">loss_function</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">optimizer</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">n_epochs</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">seed</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">123</span></em>, <em class="sig-param"><span class="n">split</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.2</span></em>, <em class="sig-param"><span class="n">batch_size</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">32</span></em>, <em class="sig-param"><span class="n">save_training_results</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.TrainingRequestHttpBody" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP Request body received from python devtools when creating a training request for a dataset.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.TrainingResult">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">TrainingResult</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">dataset</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">training_id</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">model</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.TrainingRequestHttpBody" title="dependency.TrainingRequestHttpBody">dependency.TrainingRequestHttpBody</a></span></em>, <em class="sig-param"><span class="n">complete</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">save</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">training_accuracy</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">validation_accuracy</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">training_loss</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">validation_loss</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">- 1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.TrainingResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that stores all data associated with a single training request.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.TrainingResultHttpBody">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">TrainingResultHttpBody</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">dataset_name</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">training_id</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">results</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.TrainingResultHttpBody" title="Permalink to this definition">¶</a></dt>
<dd><p>Response object sent from dataset with training results.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.UniversalMLImage">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">UniversalMLImage</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">file_names</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">[]</span></em>, <em class="sig-param"><span class="n">hash_md5</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">hash_sha1</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">hash_perceptual</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">users</span><span class="p">:</span> <span class="n">list</span> <span class="o">=</span> <span class="default_value">[]</span></em>, <em class="sig-param"><span class="n">metadata</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">models</span><span class="p">:</span> <span class="n">dict</span> <span class="o">=</span> <span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.UniversalMLImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that is used to store all data associated with a model prediction request.</p>
</dd></dl>

<dl class="py class">
<dt id="dependency.User">
<em class="property">class </em><code class="sig-prename descclassname">dependency.</code><code class="sig-name descname">User</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">password</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">roles</span><span class="p">:</span> <span class="n">list</span></em>, <em class="sig-param"><span class="n">agency</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">email</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">full_name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">disabled</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#dependency.User" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that stores all data associated with a given user account.</p>
</dd></dl>

</div>
<div class="section" id="database-connection-file">
<h2>Database Connection File<a class="headerlink" href="#database-connection-file" title="Permalink to this headline">¶</a></h2>
<p>This is the only file in the server that will make direct PyMongo calls to the server’s MongoDB instance. The
collections referenced in here and the methods will execute pre-defined queries based on the various HTTP
requests received by the server. No query is ever directly exposed to an endpoint or is directly accessible
by a client.</p>
<span class="target" id="module-db_connection"></span><dl class="py function">
<dt id="db_connection.add_api_key_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">add_api_key_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.APIKeyData" title="dependency.APIKeyData">dependency.APIKeyData</a></span></em><span class="sig-paren">)</span> &#x2192; dict<a class="headerlink" href="#db_connection.add_api_key_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a new API key into the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> – APIKeyData object to be added to database</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} if added, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.add_filename_to_image">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">add_filename_to_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.UniversalMLImage" title="dependency.UniversalMLImage">dependency.UniversalMLImage</a></span></em>, <em class="sig-param"><span class="n">filename</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.add_filename_to_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a filename to a UniversalMLImage record. This is used to track all file names that an image is uploaded to
the server under. An image file is considered “the same” if their md5 hashes are identical.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – UniversalMLImage to update</p></li>
<li><p><strong>filename</strong> – file name with extension</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.add_image_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">add_image_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.UniversalMLImage" title="dependency.UniversalMLImage">dependency.UniversalMLImage</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.add_image_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a new image to the database based on the UniversalMLImage model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> – UniversalMLImage to add to database.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.add_model_to_image_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">add_model_to_image_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.UniversalMLImage" title="dependency.UniversalMLImage">dependency.UniversalMLImage</a></span></em>, <em class="sig-param"><span class="n">model_name</span></em>, <em class="sig-param"><span class="n">result</span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.add_model_to_image_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds prediction data to a UniversalMLImage object. This is normally called when a prediction microservice
returns data to the server with the results of a prediction request. The ‘metadata’ field is always updated.
in this method as a string to enable easy querying of nested model results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – UniversalMLImage to add prediction data to</p></li>
<li><p><strong>model_name</strong> – Name of model that was run on the image.</p></li>
<li><p><strong>result</strong> – JSON results of the training</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.add_user_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">add_user_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.User" title="dependency.User">dependency.User</a></span></em><span class="sig-paren">)</span> &#x2192; dict<a class="headerlink" href="#db_connection.add_user_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a new user to the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>user</strong> – User object to add to database</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} if added, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.add_user_to_image">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">add_user_to_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.UniversalMLImage" title="dependency.UniversalMLImage">dependency.UniversalMLImage</a></span></em>, <em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.add_user_to_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a user account to a UniversalMLImage record. This is used to track which users upload images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – UniversalMLImage to update</p></li>
<li><p><strong>username</strong> – Username of user who is accessing image</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.get_api_key_by_key_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">get_api_key_by_key_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span><a class="reference internal" href="#dependency.APIKeyData" title="dependency.APIKeyData">dependency.APIKeyData</a><span class="p">]</span><a class="headerlink" href="#db_connection.get_api_key_by_key_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets an API key object from the key string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> – API key string to lookup</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>APIKeyData if key with given ID exists, else NoneType if no API key for a given key string exists.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.get_api_keys_by_user_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">get_api_keys_by_user_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.User" title="dependency.User">dependency.User</a></span></em><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span><a class="reference internal" href="#dependency.APIKeyData" title="dependency.APIKeyData">dependency.APIKeyData</a><span class="p">]</span><a class="headerlink" href="#db_connection.get_api_keys_by_user_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds all API keys which are activate and associated with a given user account.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>user</strong> – User object to find API keys associated with it</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of APIKeyData for all keys associated with user. Returns [] if no keys found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.get_bulk_training_results_reverse_order_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">get_bulk_training_results_reverse_order_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">limit</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.get_bulk_training_results_reverse_order_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the last N results for submitted training requests optionally by a user</p>
</dd></dl>

<dl class="py function">
<dt id="db_connection.get_images_from_user_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">get_images_from_user_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">page</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">search_filter</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>dict<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">search_string</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">paginate</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.get_images_from_user_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of image hashes associated with a username. This method also has pagination support and if a page
number is provided, then it will return dependency.PAGINATION_PAGE_SIZE image hashes. If the username of the user
in this request is an administrator, then all images in the server will be queried. Otherwise, only UniversalMLImage
objects that contain the username will be included in the results.</p>
<p>This method also has unique functionality to allow for filtering of image results. If these values are provided,
the mongo query will be filtered based on the fields available in search_filter and search_string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>username</strong> – Username of user to get images for</p></li>
<li><p><strong>page</strong> – Page to return of results. Will return all images if page is -1</p></li>
</ul>
</dd>
</dl>
<p>:param search_filter Optional filter to narrow down query
:param search_string String that will be matched against image metadata
:param paginate Return all results or only page
:return: Array of image hashes, total pages</p>
</dd></dl>

<dl class="py function">
<dt id="db_connection.get_models_from_image_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">get_models_from_image_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.UniversalMLImage" title="dependency.UniversalMLImage">dependency.UniversalMLImage</a></span></em>, <em class="sig-param"><span class="n">model_name</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_connection.get_models_from_image_db" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – </p></li>
<li><p><strong>model_name</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.get_user_by_name_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">get_user_by_name_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span><a class="reference internal" href="#dependency.User" title="dependency.User">dependency.User</a><span class="p">]</span><a class="headerlink" href="#db_connection.get_user_by_name_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds a user in the database by a given username.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>username</strong> – username of user</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>User object if user with given username exists, else None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.set_api_key_enabled_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">set_api_key_enabled_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.APIKeyData" title="dependency.APIKeyData">dependency.APIKeyData</a></span></em>, <em class="sig-param"><span class="n">enabled</span><span class="p">:</span> <span class="n">bool</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#db_connection.set_api_key_enabled_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables or disables a given API key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – APIKeyData object that is being modified in the DB</p></li>
<li><p><strong>enabled</strong> – Key will be enabled (True) or disabled (False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Success: True or False</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="db_connection.set_user_roles_db">
<code class="sig-prename descclassname">db_connection.</code><code class="sig-name descname">set_user_roles_db</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">username</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">updated_roles</span><span class="p">:</span> <span class="n">list</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#db_connection.set_user_roles_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the roles for a given user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>username</strong> – Username of user that will have roles modified</p></li>
<li><p><strong>updated_roles</strong> – Array of roles that user will now have</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Success: True or False</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="http-routers">
<h1>HTTP Routers<a class="headerlink" href="#http-routers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="model-prediction-router">
<h2>Model Prediction Router<a class="headerlink" href="#model-prediction-router" title="Permalink to this headline">¶</a></h2>
<p>The model prediction router handles the connection between the server and model microservices. This allows
for users to create training requests and view training results. Also, support for model registration and
utilities are included in this file</p>
<span class="target" id="module-routers.model"></span><dl class="py function">
<dt id="routers.model.create_new_prediction_on_image">
<code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">create_new_prediction_on_image</code><span class="sig-paren">(</span><em class="sig-param">images: List[fastapi.datastructures.UploadFile] = File(default=Ellipsis</em>, <em class="sig-param">extra={})</em>, <em class="sig-param">models: List[str] = ()</em>, <em class="sig-param">current_user: dependency.User = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.create_new_prediction_on_image" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>current_user</strong> – User object who is logged in</p></li>
<li><p><strong>images</strong> – List of file objects that will be used by the models for prediction</p></li>
<li><p><strong>models</strong> – List of models to run on images</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Unique keys for each image uploaded in images.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.model.get_all_prediction_models">
<em class="property">async </em><code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">get_all_prediction_models</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.get_all_prediction_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of every model that has ever been seen by the server, as well as the fields available in that model</p>
</dd></dl>

<dl class="py function">
<dt id="routers.model.get_api_key">
<code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">get_api_key</code><span class="sig-paren">(</span><em class="sig-param">api_key_header: str = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.get_api_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Validates an API contained in the header. For some reason, this method will ONLY function
when in the same file as the Depends(…) check. Therefore, this is not in auth.py</p>
</dd></dl>

<dl class="py function">
<dt id="routers.model.get_available_prediction_models">
<em class="property">async </em><code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">get_available_prediction_models</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.get_available_prediction_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns list of available models to the client. This list can be used when calling get_prediction,
with the request</p>
</dd></dl>

<dl class="py function">
<dt id="routers.model.get_model_prediction">
<code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">get_model_prediction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">host</span></em>, <em class="sig-param"><span class="n">port</span></em>, <em class="sig-param"><span class="n">filename</span></em>, <em class="sig-param"><span class="n">image_hash</span></em>, <em class="sig-param"><span class="n">model_name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.get_model_prediction" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper method to generate prediction for a given model. This will be run in a separate thread by the
redis queue</p>
</dd></dl>

<dl class="py function">
<dt id="routers.model.ping_model">
<code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">ping_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model_name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.ping_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Periodically ping the model’s service to make sure that
it is active. If it’s not, remove the model from the available_models setting</p>
</dd></dl>

<dl class="py function">
<dt id="routers.model.register_model">
<code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">register_model</code><span class="sig-paren">(</span><em class="sig-param">model: dependency.MicroserviceConnection</em>, <em class="sig-param">api_key: dependency.APIKeyData = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.register_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a single model to the server by adding the model’s name and port
to available model settings. Also kick start a separate thread to keep track
of the model service status</p>
</dd></dl>

<dl class="py function">
<dt id="routers.model.search_images">
<code class="sig-prename descclassname">routers.model.</code><code class="sig-name descname">search_images</code><span class="sig-paren">(</span><em class="sig-param">current_user: dependency.User = &lt;fastapi.params.Depends object&gt;</em>, <em class="sig-param">page_id: int = -1</em>, <em class="sig-param">search_string: str = ''</em>, <em class="sig-param">search_filter: Optional[dependency.SearchFilter] = None</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.model.search_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of image hashes of images submitted by a user. Pagination of image hashes as
well as searching is provided by this method
:param current_user: User currently logged in
:param page_id: Optional int for individual page of results (From 1…N)
:param search_filter Optional filter to narrow results by models
:param search_string Optional string to narrow results by metadata field
:return: List of hashes user has submitted (by page) and number of total pages. If no page is provided,</p>
<blockquote>
<div><p>then only the number of pages available is returned.</p>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="dataset-and-training-router">
<h2>Dataset and Training Router<a class="headerlink" href="#dataset-and-training-router" title="Permalink to this headline">¶</a></h2>
<p>The dataset and training router handles the connection and requests between the server and registered datasets.
This includes the initial dataset registration, creating training requests, viewing training result statistics,
and downloading trained model files.</p>
<span class="target" id="module-routers.training"></span><dl class="py function">
<dt id="routers.training.download_trained_model_data">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">download_trained_model_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">training_id</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.download_trained_model_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows user to download a .zip file containing a SavedModel object. This will have the trained weights from
the remote training job, and the results may be loaded back into Tensorflow2. Only admins are able to download
training results, regardless of who submits the training jobs initially.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>training_id</strong> – Training ID of job to download</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>application/octet-stream with .zip file containing SavedModel object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.get_api_key">
<code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">get_api_key</code><span class="sig-paren">(</span><em class="sig-param">api_key_header: str = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.get_api_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Validates an API contained in the header. For some reason, this method will ONLY function
when in the same file as the Depends(…) check. Therefore, this is not in auth.py</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>api_key_header</strong> – Header of HTTP request containing {‘API_KEY’: ‘keyGoesHere’}</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>APIKeyData object on success, else will raise CredentialException</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.get_available_training_datasets">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">get_available_training_datasets</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.get_available_training_datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns list of available dataset names to the client. The names of the datasets returned here can be used
when making training requests for a specific dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>{‘datasets’: List[str]} with names of all datasets available for training.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.get_bulk_training_results">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">get_bulk_training_results</code><span class="sig-paren">(</span><em class="sig-param">limit: int = -1</em>, <em class="sig-param">u: dependency.User = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.get_bulk_training_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns training results for a given user, in order of date (descending). If the user making the request is an
administrator, this method will return all training results regardless of user. Otherwise, this will only return
the last records submitted by a given person.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>limit</strong> – Number of jobs to return. If -1, will return all training results.</p></li>
<li><p><strong>u</strong> – Current User. This field is automatically generated from the authentication header parsing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} and job list on success, else HTTP error.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.get_training_result">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">get_training_result</code><span class="sig-paren">(</span><em class="sig-param">training_id: str = ''</em>, <em class="sig-param">user=&lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.get_training_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides training results for a given training ID. The ‘detail’ field in JSON will provide specific
information on the job and its current processing status. An admin may query any job and receive results, but
other users will only be able to query job IDs that they have submitted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>training_id</strong> – ID that will have records pulled for.</p></li>
<li><p><strong>user</strong> – Current User. This field is automatically generated from the authentication header parsing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} with training statistics if successful, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.get_training_stats">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">get_training_stats</code><span class="sig-paren">(</span><em class="sig-param">u: dependency.User = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.get_training_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns statistics on the number of currently training jobs and finished jobs. If the user is an administrator,
they will see the status of all training jobs and completed jobs on the server, otherwise the user will only see
the number of training and completed jobs that they have submitted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>u</strong> – Current User. This field is automatically generated from the authentication header parsing.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} with statistics if successful, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.ping_dataset">
<code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">ping_dataset</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dataset_name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.ping_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Periodically ping a dataset’s service to make sure that it is active and able to receive requests.
If it’s not, remove the dataset from the available_datasets map. This is a helper method that is
not directly exposed via HTTP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dataset_name</strong> – Name of a registered dataset as a string</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.register_dataset">
<code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">register_dataset</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dataset</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.MicroserviceConnection" title="dependency.MicroserviceConnection">dependency.MicroserviceConnection</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.register_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a single dataset to the server by adding the name and port
to available dataset settings. Also kick start a separate thread to keep track
of the dataset service status. A valid dataset API key must be in the request
header for this method to run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dataset</strong> – MicroserviceConnection object with name and port of dataset</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} if saving is successful, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.save_model_to_disk">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">save_model_to_disk</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">training_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">model</span><span class="p">:</span> <span class="n">fastapi.datastructures.UploadFile</span> <span class="o">=</span> <span class="default_value">File(default=Ellipsis, extra={})</span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.save_model_to_disk" title="Permalink to this definition">¶</a></dt>
<dd><p>Receives a .zip file containing a tensorflow2 SavedModel object sent by a dataset microservice.
Then, will store the .zip file in trained model docker volume, with the naming format of
&lt;training_id&gt;.zip</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>training_id</strong> – Training ID the model is associated with</p></li>
<li><p><strong>model</strong> – .zip file containing SavedModel object</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} if saving is successful, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.save_training_result">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">save_training_result</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">r</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#dependency.TrainingResultHttpBody" title="dependency.TrainingResultHttpBody">dependency.TrainingResultHttpBody</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.save_training_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves the model training statistics to the database. This method is called only by registered dataset
microservices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>r</strong> – Training Result with updated fields sent by dataset microservice</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} if successful update, else http error.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="routers.training.send_training_request">
<em class="property">async </em><code class="sig-prename descclassname">routers.training.</code><code class="sig-name descname">send_training_request</code><span class="sig-paren">(</span><em class="sig-param">training_data: dependency.TrainingRequestHttpBody</em>, <em class="sig-param">user=&lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.training.send_training_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new training request and sends it to the correct dataset to be trained. The unique training id that
is returned from this method will be used to query the status of the training job and track it throughout
the system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>training_data</strong> – TrainingRequestHttpBody object to be sent to the corresponding dataset</p></li>
<li><p><strong>user</strong> – Current User. This field is automatically generated from the authentication header parsing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{‘status’: ‘success’} with ‘training_id’ if successful, else {‘status’: ‘failure’}</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="authentication-router">
<h2>Authentication Router<a class="headerlink" href="#authentication-router" title="Permalink to this headline">¶</a></h2>
<p>Authentication on the server is handled via API keys and OAuth2 Bearer Tokens. Almost all endpoints which interact
with authentication and API keys are stored in this file, as well as the methods which act as helpers for OAuth2
and role validation.</p>
<span class="target" id="module-routers.auth"></span><dl class="py function">
<dt id="routers.auth.current_user_admin">
<em class="property">async </em><code class="sig-prename descclassname">routers.auth.</code><code class="sig-name descname">current_user_admin</code><span class="sig-paren">(</span><em class="sig-param">token: str = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.auth.current_user_admin" title="Permalink to this definition">¶</a></dt>
<dd><p>Permission Checking Function to be used as a Dependency
:param token: User authentication token
:return: User has sufficient permissions</p>
</dd></dl>

<dl class="py function">
<dt id="routers.auth.current_user_investigator">
<em class="property">async </em><code class="sig-prename descclassname">routers.auth.</code><code class="sig-name descname">current_user_investigator</code><span class="sig-paren">(</span><em class="sig-param">token: str = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.auth.current_user_investigator" title="Permalink to this definition">¶</a></dt>
<dd><p>Permission Checking Function to be used as a Dependency
:param token: User authentication token
:return: User has sufficient permissions</p>
</dd></dl>

<dl class="py function">
<dt id="routers.auth.current_user_researcher">
<em class="property">async </em><code class="sig-prename descclassname">routers.auth.</code><code class="sig-name descname">current_user_researcher</code><span class="sig-paren">(</span><em class="sig-param">token: str = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.auth.current_user_researcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Permission Checking Function to be used as a Dependency
:param token: User authentication token
:return: User has sufficient permissions</p>
</dd></dl>

<dl class="py function">
<dt id="routers.auth.get_current_user_profile">
<em class="property">async </em><code class="sig-prename descclassname">routers.auth.</code><code class="sig-name descname">get_current_user_profile</code><span class="sig-paren">(</span><em class="sig-param">current_user: dependency.User = &lt;fastapi.params.Depends object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#routers.auth.get_current_user_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Export the data of the current user to the client
:param current_user: Currently logged in user to have data exported
:return: Cleaned user profile</p>
</dd></dl>

<dl class="py function">
<dt id="routers.auth.get_login_status">
<em class="property">async </em><code class="sig-prename descclassname">routers.auth.</code><code class="sig-name descname">get_login_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#routers.auth.get_login_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if the user is authenticated currently
:return: Cleaned user profile</p>
</dd></dl>

</div>
</div>
<div class="section" id="docker-redis-worker">
<h1>Docker Redis Worker<a class="headerlink" href="#docker-redis-worker" title="Permalink to this headline">¶</a></h1>
<p>Docker handles the integration of workers which interact with various redis-queues used by the server.
There is almost no worker-specific code other than the worker.py file, as the workers receive a copy of all of
the server files to interact with.</p>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Cody Richter.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>